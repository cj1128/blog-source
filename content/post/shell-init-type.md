---
title: Shell å¯åŠ¨ç±»å‹æ¢ç©¶ â”€â”€ login && interactive
date: 2020-08-16T11:30:23+08:00
cover: http://asset.cjting.cn/FgNP1hv-An94wEaBmEuMraLR457-.jpg
---

Shell å¯¹ç¨‹åºå‘˜æ¥è¯´æ˜¯å¿…ä¸å¯å°‘çš„ç”Ÿäº§åŠ›å·¥å…·ã€‚

```text
$ figlet <<< "Hello Shell"
 _   _      _ _         ____  _          _ _
| | | | ___| | | ___   / ___|| |__   ___| | |
| |_| |/ _ \ | |/ _ \  \___ \| '_ \ / _ \ | |
|  _  |  __/ | | (_) |  ___) | | | |  __/ | |
|_| |_|\___|_|_|\___/  |____/|_| |_|\___|_|_|

```

<!--more-->

ä¸‹é¢è¿™æ¡æŒ‡ä»¤å¯ä»¥æŸ¥çœ‹ Shell ä¸­æˆ‘ä»¬æœ€å¸¸ç”¨çš„ 10 æ¡å‘½ä»¤ï¼Œå¤§å®¶å¯ä»¥è¯•ä¸€è¯•ã€‚

```bash
$ history | awk '{CMD[$2]++;count++;}END { for (a in CMD)print CMD[a] " " CMD[a]/count*100 "% " a;}' | grep -v "./" | column -c3 -s " " -t | sort -nr | nl |  head -n10
 1  429  16.6473%    ls
 2  235  9.11913%    vim
 3  204  7.91618%    gss
 4  186  7.21769%    yarn
 5  169  6.55801%    cd
 6  86   3.33721%    j
 7  75   2.91036%    git
 8  64   2.48351%    subl
 9  49   1.90144%    rg
10  49   1.90144%    glog
```

æ²¡æƒ³åˆ°æˆ‘æœ€å¸¸ç”¨çš„æ˜¯ `ls`ï¼Œä¸è¿‡ä¹ŸæŒºåˆç†çš„ï¼Œæ¯•ç«Ÿåšä»»ä½•æ“ä½œä¹‹å‰ä¹ æƒ¯æ€§çš„ ls ä¸€ä¸‹ã€‚(æˆ‘çš„ ls å®é™…ä¸Šé“¾æ¥åˆ°äº† [exa](https://github.com/ogham/exa))ã€‚

å…³äº Shell æœ‰å¤ªå¤šçš„è¯é¢˜å¯ä»¥è°ˆäº†ï¼š

- å„ç§ Shell çš„ç‰¹æ€§åŒºåˆ«ï¼šBash/Zsh/Fish/Csh...
- Shell ä¸­çš„å„ç§æ¦‚å¿µï¼šCommand/Function/Alias/Environment Variable/Built-in Command...
- æ€æ ·é…ç½®ä¸€ä¸ªè®©å¤§å®¶éƒ½ç¾¡æ…•çš„æç¤ºç¬¦ï¼š[spaceship-prompt](https://github.com/denysdovhan/spaceship-prompt), [powerline-shell](https://github.com/b-ryan/powerline-shell)...
- Shell çš„ç¼–ç¨‹ç‰¹æ€§ï¼šIf/While/Variable/Array...
- å„ç§æå¤§æé«˜ç”Ÿäº§åŠ›çš„å·¥å…·ï¼šOh My Zsh/Ripgrep/Exa/Htop...
- Windows ä¸Šçš„ Shell é…ç½®ï¼šWindows Terminal/PowerShell/MSYS2/MinGW...

è¿™äº›ï¼Œéƒ½ä¸æ˜¯è¿™ç¯‡åšå®¢çš„ä¸»é¢˜ ğŸ˜‰ è¿™ç¯‡åšå®¢æˆ‘æƒ³è°ˆä¸€ä¸ªæ¯”è¾ƒç»†èŠ‚çš„è¯é¢˜ï¼šShell çš„å¯åŠ¨ç±»å‹ã€‚

ç¬¬ä¸€æ¬¡é‡åˆ°è¿™ä¸ªé—®é¢˜å¤§çº¦æ˜¯åœ¨äº”å¹´å‰ï¼Œæœ‰ä¸€æ¬¡å»æœ‹å‹å®¶ç©è€ï¼Œæœ‹å‹é—®äº†æˆ‘ä¸€ä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆä»–çš„è„šæœ¬åœ¨æ‰§è¡Œæ—¶æç¤ºæ‰¾ä¸åˆ° `node` æŒ‡ä»¤ï¼Œè€Œä»–åœ¨ç»ˆç«¯ä¸­è¾“å…¥ `node` æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚

å½“æ—¶æˆ‘éšçº¦æ„Ÿè§‰åˆ°æ˜¯ Shell å¯åŠ¨ç±»å‹ä¸åŒå¯¼è‡´çš„é—®é¢˜ï¼Œä½†æ˜¯å…·ä½“çš„æœºåˆ¶æˆ‘è¯´ä¸ä¸Šæ¥ã€‚

å½“ç„¶ï¼Œæœ€åæˆ‘ç»™äº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œè™½ç„¶è°ˆä¸ä¸Šä¼˜é›…ä½†æ˜¯ç®¡ç”¨ï¼Œé‚£å°±æ˜¯ä½¿ç”¨ç»å¯¹è·¯å¾„ã€‚äº”å¹´åçš„ä»Šå¤©ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œè¿™ä¸ªé—®é¢˜ç©¶ç«Ÿæ˜¯æ€ä¹ˆå›äº‹ã€‚

## ä»€ä¹ˆæ˜¯ Shellï¼Ÿ

é¦–å…ˆï¼Œæˆ‘ä»¬è¦å˜æ¸…ä¸€ä¸ªæ¦‚å¿µï¼šä»€ä¹ˆæ˜¯ Shellï¼Ÿ

å¾ˆé•¿ä¸€æ®µæ—¶é—´å†…æˆ‘ä¸ç†è§£ä»€ä¹ˆæ˜¯ Shellï¼Œä¹Ÿæä¸æ¸… Shell å’Œ Terminal çš„åŒºåˆ«ï¼Œåªç¬¼ç»Ÿåœ°è®¤ä¸º iTerm å°±æ˜¯ Shellã€‚

æˆ‘ä»¬å…ˆæ¥çœ‹å­—å…¸å¯¹ Shell çš„é‡Šä¹‰ï¼š

> the hard outer covering of something, especially nuts, eggs, and some animals.

ä»è¿™ä¸ªè§£é‡Šæ¥çœ‹ Shell æŒ‡çš„æ˜¯ç‰©ä½“è¡¨é¢çš„å¤–å£³ï¼Œåœ¨è®¡ç®—æœºä¸­è¿™å…¶å®æ˜¯ä¸€ä¸ªæ¯”å–»ï¼Œ**Shell æ˜¯ Kernel çš„å¤–å£³**ã€‚

[è¿™ä¸ªé“¾æ¥](https://unix.stackexchange.com/questions/11454/what-is-the-difference-between-a-builtin-command-and-one-that-is-not/11465#11465) å¯¹è¿™ä¸ªé—®é¢˜å›ç­”åœ°å¾ˆå¥½ï¼Œæˆ‘æ‘˜å½•å¦‚ä¸‹ï¼š

> A shell is a program that prints a prompt, reads a line of input from you, and then interprets it as one or more commands to manipulate files or run other programs. Before the invention of the GUI, the shell was the primary user interface of an OS.

Shell é¦–å…ˆæ˜¯ä¸€ä¸ªç¨‹åºï¼Œè¿™ä¸ªç¨‹åºç”¨æ¥å’Œ Kernel è¿›è¡Œäº¤äº’ï¼Œåœ¨ GUI å‘æ˜ä¹‹å‰ï¼ŒShell æ˜¯å’Œ Kernel äº¤äº’çš„å”¯ä¸€æ–¹å¼ã€‚

åœ¨ GUI å‘æ˜ä¹‹åï¼ŒæŸäº›äº¤äº’è½¬ç§»åˆ° GUI å®Œæˆï¼Œä½†æ˜¯ Shell ä¾ç„¶ä¿ç•™äº†ä¸‹æ¥ï¼Œå› ä¸ºå¯¹äºé«˜çº§è®¡ç®—æœºä½¿ç”¨è€…ï¼ŒShell çš„çµæ´»æ€§å’ŒåŠŸèƒ½çš„å¼ºå¤§æ€§æ˜¯ GUI æ— æ³•æ¯”æ‹Ÿçš„ã€‚

## ç±»å‹å’Œåœºæ™¯

{{% tip %}}
åç»­æˆ‘ä»¬çš„è®¨è®ºå…¨éƒ¨åŸºäº [Manjaro Linux](https://manjaro.org/) å’Œ [Bash](https://www.gnu.org/software/bash/)ã€‚
{{% /tip %}}

ç”±äºä½¿ç”¨åœºæ™¯çš„ä¸åŒï¼ŒShell è¢«åˆ†ä¸ºä¸¤ä¸ªç±»å‹ï¼š

- `login` / `non-login`
- `interactive` / `non-interactive`

è¿™ä¸¤ä¸ªç±»å‹å½±å“çš„æ˜¯ **Shell çš„å¯åŠ¨æ–‡ä»¶ (startup files)**ã€‚

`login` / `non-login` Shell æˆ‘ä»¬ç°åœ¨ä¸å¤ªå¥½æ„ŸçŸ¥äº†ã€‚å¦‚æœæŠŠæ—¶é—´æ‹¨å›åˆ°ä¸Šä¸ªä¸–çºªè¿˜æ²¡æœ‰ GUI çš„æ—¶å€™ï¼Œå°±å¾ˆå¥½ç†è§£ã€‚

å½“æˆ‘ä»¬ä½¿ç”¨ç»ˆç«¯ç™»å½•ä¸€å°ä¸»æœºæ—¶ï¼Œä¸»æœºä¼šä¸ºæˆ‘ä»¬å¯åŠ¨ä¸€ä¸ª Shellï¼Œç”±äºæ˜¯ç™»å½•ä»¥åå¯åŠ¨çš„ï¼Œæ‰€ä»¥æ˜¯ login Shellã€‚

login Shell ä¼šåˆå§‹åŒ–ä¸€äº›é’ˆå¯¹æ•´ä¸ªç™»å½•ä¼šè¯çš„ä»»åŠ¡ï¼Œæ¯”å¦‚è¯´ï¼Œæˆ‘å¸Œæœ›æˆ‘æ¯æ¬¡ç™»å½•ä¸»æœºï¼Œå°±è‡ªåŠ¨å‘ä¸€å°é‚®ä»¶å‡ºå»ï¼Œé‚£ä¹ˆè¿™ä¸ªä»»åŠ¡å°±å¯ä»¥åœ¨ login Shell çš„å¯åŠ¨æ–‡ä»¶ä¸­å®Œæˆã€‚

å…¶ä»–æƒ…å†µçš„ Shell å°±æ˜¯ non-login çš„ï¼Œæ¯”å¦‚æˆ‘ç™»å½•ä»¥åï¼Œè¾“å…¥ `bash` å†å¯åŠ¨ä¸€ä¸ª Shellï¼Œé‚£ä¹ˆè¿™ä¸ª Shell å°±æ˜¯ non-login çš„ã€‚

`interactive` / `non-interactive` å°±æ¯”è¾ƒå¥½ç†è§£äº†ã€‚æ—¥å¸¸æˆ‘ä»¬åœ¨ç»ˆç«¯ä¸­ä½¿ç”¨çš„å°±æ˜¯ interactive Shellï¼Œå®ƒä¼šè¾“å‡ºæç¤ºç¬¦ï¼Œä¼šæœ‰ Job Control ç­‰åŠŸèƒ½ã€‚

è€Œå½“æˆ‘ä»¬æ‰§è¡Œ Shell è„šæœ¬æ—¶ä¾‹å¦‚ `bash test.sh`ï¼Œé‚£ä¹ˆæ­¤æ—¶çš„ Shell ä¾¿æ˜¯ non-interactive çš„ã€‚

ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤å¯ä»¥æ£€æµ‹å½“å‰ Shell æ˜¯å¦æ˜¯ interactive çš„ï¼š

```bash
[[ $- == *i* ]] && echo 'Interactive shell' || echo 'Non-interactive shell'
```

è€Œè¿™æ¡å‘½ä»¤å¯ä»¥æ£€æµ‹ Shell æ˜¯å¦æ˜¯ login çš„ï¼š

```bash
shopt -q login_shell && echo 'Login shell' || echo 'Non-login shell'
```

æ£€æµ‹æ˜¯å¦æ˜¯ login Shell è¿˜æœ‰ä¸€ä¸ªåŠæ³•ï¼Œé‚£å°±æ˜¯è¾“å…¥ `logout`ï¼Œå¦‚æœæ˜¯ login Shellï¼Œæ•ˆæœç›¸å½“äº `exit`ï¼Œå¦‚æœä¸æ˜¯ï¼Œä¼šæç¤º `logout: not login shell`ã€‚

## å¯åŠ¨æ–‡ä»¶

ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬å¯¹ Bash çš„é…ç½®éƒ½ä¼šæ”¾åœ¨ `~/.bashrc` ä¸­ï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“ Bash åœ¨å¯åŠ¨ä»¥åä¼š source è¿™ä¸ªæ–‡ä»¶ã€‚ä½†å…¶å®è¿™å¹¶ä¸ä¸€å®šï¼Œå¯åŠ¨ç±»å‹ä¼šå½±å“å¯åŠ¨æ–‡ä»¶ã€‚

ç°åœ¨æˆ‘ä»¬çŸ¥é“äº† Shell ç»„åˆèµ·æ¥çœ‹æœ‰å››ç§ç±»å‹ï¼š

- `login + interactive`
- `login + non-interactive`
- `non-login + interactive`
- `non-login + non-interactive`

é‚£ä¹ˆå®ƒä»¬çš„å¯åŠ¨æ–‡ä»¶åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªæ¥å®éªŒã€‚

æˆ‘ä»¬é¦–å…ˆ SSH åˆ°æˆ‘ä»¬çš„ Manjaro ä¸»æœºä¸Šï¼Œæ­¤æ—¶å¾—åˆ°çš„ Shell å°±æ˜¯ `login + interactive` çš„ã€‚

å®éªŒæ–¹å¼ä¸ºæƒ³åŠæ³•å¯åŠ¨ç‰¹å®šç±»å‹çš„ Shellï¼Œä½¿ç”¨ `strace` è¿½è¸ªç³»ç»Ÿè°ƒç”¨ï¼Œé€šè¿‡ç³»ç»Ÿè°ƒç”¨åˆ†æ Shell æ‰“å¼€äº†å“ªäº›æ–‡ä»¶ã€‚

é¦–å…ˆæµ‹è¯•ç¬¬ä¸€ç§ï¼Œ`login + interactive`ã€‚

SSH ç™»å½•ä»¥åï¼Œè¾“å…¥æŒ‡ä»¤ `strace -f -e trace=file -o /tmp/login_interactive /bin/bash -l`ã€‚

`-l` å‚æ•°å¯ä»¥å¼ºåˆ¶ Bash å˜æˆ login Shellï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå·²ç»ç™»å½•åå†ä½¿ç”¨ Bash å¾—åˆ°çš„æ˜¯ non-login Shellã€‚

åˆ†ææ–‡ä»¶å¯ä»¥å¾—å‡ºï¼Œ`login + interactive` Shell çš„å¯åŠ¨æ–‡ä»¶å¦‚ä¸‹ï¼š

- `/etc/profile`
- `/etc/profile.d/...`
- `~/.bash_profile`, `~/.bash_login`, `~/.profile` æŒ‰é¡ºåºæ‰¾åˆ°çš„ç¬¬ä¸€ä¸ª

æ¥ä¸‹æ¥æ˜¯ç¬¬äºŒç§ï¼Œ`login + non-interactive`ã€‚

SSH ç™»å½•ä»¥åï¼Œéšä¾¿ç¼–å†™ä¸€ä¸ªè„šæœ¬ `test.sh`ï¼Œç„¶åä½¿ç”¨ `bash -l test.sh` å¾—åˆ°çš„å°±æ˜¯ `login + non-interactive` çš„ Shellã€‚

å¯åŠ¨æ–‡ä»¶å¦‚ä¸‹ï¼š

- `/etc/profile`
- `/etc/profile.d/...`
- `~/.bash_profile`, `~/.bash_login`, `~/.profile` æŒ‰é¡ºåºæ‰¾åˆ°çš„ç¬¬ä¸€ä¸ª

å¯ä»¥å‘ç°ï¼Œ`login + non-interactive` å’Œ `login + interactive` æ¨¡å¼çš„å¯åŠ¨æ–‡ä»¶æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚

ç¬¬ä¸‰ç§æƒ…å†µï¼Œ`non-login + interactive`ã€‚

SSH ç™»å½•ä»¥åï¼Œè¾“å…¥ `bash` å†å¯åŠ¨ä¸€ä¸ª Bash å°±æ˜¯ `non-login + interactive` çš„ã€‚

å¯åŠ¨æ–‡ä»¶å¦‚ä¸‹ï¼š

- `/etc/bash.bashrc`
- `~/.bashrc`

æœ€åä¸€ç§æƒ…å†µï¼Œ`non-login + non-interactive`ï¼ŒSSH ç™»å½•ä»¥åï¼Œè¿è¡Œ `bash test.sh` å¾—åˆ°çš„å°±æ˜¯è¿™ç§æƒ…å†µã€‚

**è¿™ç§æƒ…å†µä¸‹ï¼Œæ²¡æœ‰å¯åŠ¨æ–‡ä»¶**ã€‚ä½†æ˜¯ï¼ŒBash ä¼šæŸ¥çœ‹ä¸€ä¸ªç‰¹æ®Šçš„ç¯å¢ƒå˜é‡ `BASH_ENV`ï¼Œå¦‚æœè¿™ä¸ªå˜é‡æœ‰å€¼ï¼Œä¼š source è¿™ä¸ªå˜é‡æŒ‡å‘çš„æ–‡ä»¶ã€‚

æ‰€ä»¥æ€»ç»“ä¸€ä¸‹ï¼Œå…¶å®å››ç§å¯åŠ¨ç±»å‹å®šä¹‰äº†ä¸‰ç§å¯åŠ¨æ–‡ä»¶ï¼Œå› ä¸º `login + interactive` å’Œ `login + non-interactive` æ˜¯ä¸€æ ·çš„ã€‚

æ—¥å¸¸æˆ‘ä»¬åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œè„šæœ¬ï¼Œéƒ½æ˜¯ `non-login + non-interactive` è¿™ç§æƒ…å†µï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰ä»»ä½•å¯åŠ¨æ–‡ä»¶ï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰å‡ºé—®é¢˜ï¼Ÿè¿™æ˜¯å› ä¸ºæ‰€æœ‰çš„è¿›ç¨‹éƒ½ä¼šä»çˆ¶è¿›ç¨‹ä¸­ç»§æ‰¿ç¯å¢ƒå˜é‡ï¼Œè€Œå¯¹æ—¥å¸¸ä½¿ç”¨å½±å“æœ€å¤§çš„ PATH å˜é‡ä¼šè¢«ç»§æ‰¿è¿‡æ¥ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸ä¼šå‡ºé—®é¢˜ã€‚

é™¤äº†ä¸Šè¿°çš„é»˜è®¤è¡Œä¸ºï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ Bash çš„ä¸€äº›é€‰é¡¹æ¥è°ƒæ•´å¯åŠ¨æ–‡ä»¶ï¼Œæ¯”å¦‚ `--rcfile`, `--noprofile`, `--norc`ï¼Œä»¥åŠä½¿ç”¨ `-l` å’Œ `-i` æ¥è°ƒæ•´ Bash çš„å¯åŠ¨ç±»å‹ã€‚

æœ€åæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ï¼Œå¯ä»¥å¾—åˆ°è¿™æ ·ä¸€å¹…å›¾ã€‚

![](http://asset.cjting.cn/Fp3wlzbJBjk9xBPbr-t8SHf9KTbb.png)

æ˜¯çš„ï¼Œçœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œæ¬¢è¿æ¥åˆ°çœŸå®ä¸–ç•ŒğŸ™‚ã€‚å¥½åœ¨æˆ‘ä»¬æ— éœ€å»è®°ä½è¿™äº›ç»†èŠ‚ï¼Œåªè¦åšåˆ°å¦‚æœæœ‰ä¸€å¤©é‡åˆ°äº†é—®é¢˜ï¼Œæœ‰ä¸€ä¸ªæ¸…æ™°çš„æ’æŸ¥æ–¹å‘å°±è¡Œäº†ã€‚

æ—¥å¸¸ä½¿ç”¨ä¸­ï¼Œå¯¹äº Bash çš„é…ç½®å°±æ”¾åœ¨ `~/.bashrc` ä¸­å³å¯ã€‚`~/.bash_profile` ä¸€èˆ¬ä¼šå«æœ‰ source `~/.bashrc` çš„ä»£ç ï¼Œæ‰€ä»¥ä¸ç®¡ login è¿˜æ˜¯ non-loginï¼Œ `.bashrc` æ–‡ä»¶éƒ½ä¼šè¢«æ‰§è¡Œã€‚

```bash
# Manjaro é»˜è®¤çš„ ~/.bash_profile
[[ -f ~/.bashrc ]] && . ~/.bashrc
```

{{% tip %}}
æœ‰å¥½å¥‡è¿‡ `rc` åç¼€æ˜¯ä»€ä¹ˆæ„æ€å—ï¼Ÿ[rc = run commands](https://unix.stackexchange.com/questions/3467/what-does-rc-in-bashrc-stand-for)
{{% /tip %}}

å†æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„æƒ…å†µå°±æ˜¯ï¼Œå¸¸ç”¨ Shell çš„åœ°æ–¹æ¯”å¦‚ Crontabï¼Œä»¥åŠåœ¨å„ç§ç¼–ç¨‹è¯­è¨€ä¸­è°ƒèµ·çš„ Shellï¼Œæ¯”å¦‚ Python çš„ `os.system` ä»¥åŠ Node çš„ `child_process.exec` æ‰§è¡Œçš„éƒ½æ˜¯ `non-login + non-interactive` çš„ Shellï¼Œä¹Ÿå°±æ˜¯ä»€ä¹ˆå¯åŠ¨æ–‡ä»¶éƒ½ä¸ä¼š sourceï¼Œåªä¼šç»§æ‰¿ç¯å¢ƒå˜é‡ã€‚

å…¶å®ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªç»†èŠ‚ï¼ŒCrontab, Python, Node, Make ä»¥åŠå…¶ä»–å¤§éƒ¨åˆ†ä½¿ç”¨ Shell çš„ç¨‹åºï¼Œé»˜è®¤ä½¿ç”¨çš„ Shell éƒ½æ˜¯ `/bin/sh`ã€‚åœ¨å¤§éƒ¨åˆ†ç³»ç»Ÿä¸Šï¼Œè¿™ä¸ªæ–‡ä»¶é“¾æ¥åˆ°äº† /bin/bashã€‚ä½†æ˜¯ï¼Œå¦‚æœ Bash å‘ç°è‡ªå·±æ˜¯ä»¥ `/bin/sh` çš„èº«ä»½å¯åŠ¨çš„ï¼Œä¹Ÿå°±æ˜¯ `$0` æ˜¯ `/bin/sh` çš„è¯ï¼Œå®ƒçš„è¡Œä¸ºä¼šå‘ç”Ÿæ”¹å˜ï¼ŒåŒ…æ‹¬å¯åŠ¨æ–‡ä»¶ï¼Œä¼šè°ƒæ•´è‡ªå·±å°½é‡å’Œ sh(Bourne shell) å…¼å®¹ã€‚æ¯”å¦‚è¯´ï¼Œåœ¨ `non-login + non-interactive` æƒ…å†µä¸‹å®ƒä¸ä¼š source `$BASH_ENV`ã€‚

æˆ‘ä»¬ä»¥ Node ä¸ºä¾‹ï¼Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶ `echo 'hello from test.sh' > test.sh`ï¼Œç„¶åè®¾ç½® BASH_ENV æŒ‡å‘è¿™ä¸ªæ–‡ä»¶å¹¶å¯åŠ¨ Nodeã€‚

```bash
$ BASH_ENV=test.sh node
> const c = require("child_process")
> c.execSync("echo hello").toString()
'hello\n' # å¯ä»¥å‘ç° 'hello from test.sh' æ²¡æœ‰æ‰“å°ï¼Œä¹Ÿå°±æ˜¯ BASH_ENV æŒ‡å‘çš„æ–‡ä»¶æ²¡æœ‰è¢« source
> c.execSync("echo hello", {shell: "/bin/bash"})
'hello from test.sh\nhello\n' # è¿™æ¬¡æœ‰äº†
> c.execSync("echo $0").toString()
'/bin/sh\n' # é»˜è®¤æƒ…å†µä¸‹æ‰§è¡Œçš„æ˜¯ /bin/sh
```

## ZSH

æˆ‘ä»¬ä¸ªäººå¼€å‘ç”µè„‘ä¸€èˆ¬å¤šä½¿ç”¨ ZSHï¼Œæ¯•ç«Ÿé…åˆ Oh-My-Zsh ä»¥åå®åœ¨æ˜¯å¤ªå¥½ç”¨äº†ã€‚

ZSH åœ¨å¯åŠ¨æ–‡ä»¶æ–¹é¢å’Œ Bash æœ‰æ‰€ä¸åŒï¼Œ[Startup Files](http://zsh.sourceforge.net/Intro/intro_3.html) æ˜¯ ZSH å®˜æ–¹çš„è¯´æ˜æ–‡æ¡£ã€‚é€šè¿‡è¿™ä¸ªéå¸¸ç®€ç•¥çš„æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ ZSH ç›¸å…³çš„å¯åŠ¨æ–‡ä»¶æœ‰ 5 ä¸ªï¼š

- `.zshenv`
- `.zprofile`
- `.zshrc`
- `.zlogin`
- `.zlogout`

è¿™ 5 ä¸ªæ–‡ä»¶åˆ†åˆ«æœ‰ç³»ç»Ÿçº§å’Œç”¨æˆ·çº§çš„åŒºåˆ«ï¼Œä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€ä¸€æµ‹è¯•ä¸åŒçš„å¯åŠ¨ç±»å‹ä¼š source ä»€ä¹ˆæ ·çš„å¯åŠ¨æ–‡ä»¶ï¼Œè¿™é‡Œä¸å†èµ˜è¿°äº†ï¼Œç›´æ¥è´´å‡ºç»“æœã€‚

```
+----------------+-----------+-----------+------+
|                |   Login   |Interactive|Script|
|                |           |non-login  |      |
+----------------+-----------+-----------+------+
|/etc/zshenv     |    1      |    1      |  1   |
+----------------+-----------+-----------+------+
|~/.zshenv       |    2      |    2      |  2   |
+----------------+-----------+-----------+------+
|/etc/zprofile   |    3      |           |      |
+----------------+-----------+-----------+------+
|~/.zprofile     |    4      |           |      |
+----------------+-----------+-----------+------+
|/etc/zshrc      |    5      |    3      |      |
+----------------+-----------+-----------+------+
|~/.zshrc        |    6      |    4      |      |
+----------------+-----------+-----------+------+
|/etc/zlogin     |    7      |           |      |
+----------------+-----------+-----------+------+
|~/.zlogin       |    8      |           |      |
+----------------+-----------+-----------+------+
|                |           |           |      |
+----------------+-----------+-----------+------+
|                |           |           |      |
+----------------+-----------+-----------+------+
|~/.zlogout      |    9      |           |      |
+----------------+-----------+-----------+------+
|/etc/zlogout    |    10     |           |      |
+----------------+-----------+-----------+------+
```

ZSH å’Œ Bash ä¸€æ ·ï¼Œ`login + interactive` å’Œ `login + non-interactive` çš„å¯åŠ¨æ–‡ä»¶æ˜¯ä¸€æ ·çš„ï¼Œä¸Šè¡¨ä¸­å½’ä¸º `Login`ï¼Œ`Script` æŒ‡çš„æ˜¯ `non-login + non-interactive`ã€‚

ZSH å’Œ Bash éå¸¸ä¸ä¸€æ ·çš„ä¸€ç‚¹å°±æ˜¯ä¸ç®¡ä»€ä¹ˆæƒ…å†µä¸‹ ZSH éƒ½ä¼š source `.zshenv` æ–‡ä»¶ã€‚è¿™ä¸ªç›¸æ¯” Bash å°±æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„ç‰¹æ€§äº†ï¼Œä»æ–‡ä»¶åå¯ä»¥çœ‹å‡ºè¿™ä¸ªæ–‡ä»¶ä¸»è¦è´Ÿè´£è®¾ç½®ä¸€äº›ç¯å¢ƒå˜é‡ï¼Œæ¯”å¦‚ `PATH`, `LC_ALL`, `EDITOR`, `GOPATH`, `GOROOT`ç­‰ç­‰ã€‚è¿™æ ·åœ¨ Crontab ç­‰ç¯å¢ƒä¸­ï¼Œå°±ä¸ä¼šå‡ºç° command not found çš„é—®é¢˜äº†ã€‚

ZSH è¿™ä¹ˆå¤šé…ç½®æ–‡ä»¶ï¼Œå…·ä½“è¯¥æ€ä¹ˆç”¨ï¼Ÿä»€ä¹ˆæ ·çš„é…ç½®æ”¾åœ¨ä»€ä¹ˆæ ·çš„æ–‡ä»¶ä¸­ï¼Ÿ[è¿™é‡Œ](https://unix.stackexchange.com/questions/71253/what-should-shouldnt-go-in-zshenv-zshrc-zlogin-zprofile-zlogout) æ˜¯ StackExchange ä¸­ä¸€ä¸ªé—®ç­”ï¼Œéå¸¸çš„è¯¦ç»†ï¼Œå¯ä»¥ä½œä¸ºå‚è€ƒã€‚

ç®€å•æ¥è¯´ï¼Œåœ¨ `.zshenv` æ–‡ä»¶ä¸­åˆå§‹åŒ–å„ç§ç¯å¢ƒå˜é‡ï¼Œé‡Œé¢åº”è¯¥å…¨éƒ¨éƒ½æ˜¯ `export NAME=VALUE` è¿™æ ·çš„è¯­å¥ã€‚

åœ¨ `.zshrc` æ–‡ä»¶ä¸­ï¼Œåˆå§‹åŒ–äº¤äº’æ¨¡å¼è¦ç”¨çš„ä¸œè¥¿ï¼ŒåŒ…æ‹¬

- å„ç§ function å®šä¹‰
- `setopt` ç»ˆç«¯å±æ€§é…ç½®
- å„ç§ alias å®šä¹‰
- PS1 æç¤ºç¬¦é…ç½®
- å‘½ä»¤è¡¥å…¨è„šæœ¬åŠ è½½
- å„ç§é«˜äº®å’Œé¢œè‰²é…ç½®ï¼Œæ¯”å¦‚ zsh-syntax-highlighting
- å¿«æ·é”®è®¾ç½®
- autojump ç­‰ç­‰

## å‚è€ƒ

- [Zsh/Bash startup files loading order](https://medium.com/@rajsek/zsh-bash-startup-files-loading-order-bashrc-zshrc-etc-e30045652f2e)
- [Zsh/Bash startup files loading order (.bashrc, .zshrc etc.)](https://shreevatsa.wordpress.com/2008/03/30/zshbash-startup-files-loading-order-bashrc-zshrc-etc/)
- [Bash initialization behaviour](https://github.com/0cjs/sedoc/blob/master/lang/bash/init.md)

